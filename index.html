<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C++ Web Messenger</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>
    <!-- –≠–∫—Ä–∞–Ω –≤—ã–±–æ—Ä–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
    <div id="login-screen" class="screen active">
        <div class="login-container">
            <div class="login-header">
                <h1><i class="fas fa-code"></i> C++ Messenger</h1>
                <p class="subtitle">–í–µ–±-–º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä –Ω–∞ C++/WebAssembly</p>
            </div>
            
            <div class="users-grid">
                <div class="user-card" onclick="selectUser(1)">
                    <div class="user-avatar" style="background: linear-gradient(135deg, #007AFF, #0055CC);">
                        <i class="fas fa-user-secret"></i>
                    </div>
                    <div class="user-info">
                        <h3>–ê–ª–µ–∫—Å–µ–π</h3>
                        <p class="user-status online">–í —Å–µ—Ç–∏</p>
                        <p class="user-title">C++ –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫</p>
                    </div>
                </div>
                
                <div class="user-card" onclick="selectUser(2)">
                    <div class="user-avatar" style="background: linear-gradient(135deg, #FF2D55, #CC2255);">
                        <i class="fas fa-user-graduate"></i>
                    </div>
                    <div class="user-info">
                        <h3>–ú–∞—Ä–∏—è</h3>
                        <p class="user-status online">–í —Å–µ—Ç–∏</p>
                        <p class="user-title">Web –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫</p>
                    </div>
                </div>
                
                <div class="user-card" onclick="selectUser(3)">
                    <div class="user-avatar" style="background: linear-gradient(135deg, #32D74B, #22CC55);">
                        <i class="fas fa-user-tie"></i>
                    </div>
                    <div class="user-info">
                        <h3>–î–º–∏—Ç—Ä–∏–π</h3>
                        <p class="user-status online">–í —Å–µ—Ç–∏</p>
                        <p class="user-title">DevOps –ò–Ω–∂–µ–Ω–µ—Ä</p>
                    </div>
                </div>
                
                <div class="user-card" onclick="selectUser(4)">
                    <div class="user-avatar" style="background: linear-gradient(135deg, #FF9500, #CC7700);">
                        <i class="fas fa-user-ninja"></i>
                    </div>
                    <div class="user-info">
                        <h3>–ê–Ω–Ω–∞</h3>
                        <p class="user-status online">–í —Å–µ—Ç–∏</p>
                        <p class="user-title">Data Scientist</p>
                    </div>
                </div>
            </div>
            
            <div class="login-footer">
                <div class="tech-badges">
                    <span class="badge cpp">C++</span>
                    <span class="badge wasm">WebAssembly</span>
                    <span class="badge html">HTML5</span>
                    <span class="badge local">–õ–æ–∫–∞–ª—å–Ω—ã–π</span>
                </div>
                <p class="tech-info">–í—Å–µ –¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –≤ –≤–∞—à–µ–º –±—Ä–∞—É–∑–µ—Ä–µ</p>
            </div>
        </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–∞ -->
    <div id="messenger-screen" class="screen">
        <!-- –ü–∞–Ω–µ–ª—å –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ -->
        <nav class="navbar">
            <div class="nav-left">
                <button class="nav-btn" onclick="toggleSidebar()">
                    <i class="fas fa-bars"></i>
                </button>
                <div class="current-user">
                    <div class="mini-avatar" id="current-user-avatar"></div>
                    <div class="user-details">
                        <h3 id="current-user-name">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</h3>
                        <p id="current-user-status" class="user-status">–í —Å–µ—Ç–∏</p>
                    </div>
                </div>
            </div>
            
            <div class="nav-center">
                <h2><i class="fas fa-comments"></i> C++ Messenger</h2>
            </div>
            
            <div class="nav-right">
                <button class="nav-btn" onclick="showSettings()" title="–ù–∞—Å—Ç—Ä–æ–π–∫–∏">
                    <i class="fas fa-cog"></i>
                </button>
                <button class="nav-btn" onclick="exportData()" title="–≠–∫—Å–ø–æ—Ä—Ç">
                    <i class="fas fa-download"></i>
                </button>
                <button class="nav-btn logout" onclick="logout()" title="–í—ã–π—Ç–∏">
                    <i class="fas fa-sign-out-alt"></i>
                </button>
            </div>
        </nav>

        <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
        <div class="main-content">
            <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å -->
            <div class="sidebar" id="sidebar">
                <div class="sidebar-header">
                    <h3><i class="fas fa-users"></i> –ö–æ–Ω—Ç–∞–∫—Ç—ã</h3>
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" id="search-contacts" placeholder="–ü–æ–∏—Å–∫ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤...">
                    </div>
                </div>
                
                <div class="contacts-list" id="contacts-list">
                    <!-- –ö–æ–Ω—Ç–∞–∫—Ç—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∏–∑ C++ -->
                </div>
                
                <div class="sidebar-footer">
                    <div class="system-info">
                        <p><i class="fas fa-microchip"></i> C++ Core: <span id="cpp-status">–ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è...</span></p>
                        <p><i class="fas fa-database"></i> –°–æ–æ–±—â–µ–Ω–∏–π: <span id="message-count">0</span></p>
                    </div>
                </div>
            </div>

            <!-- –û–±–ª–∞—Å—Ç—å —á–∞—Ç–∞ -->
            <div class="chat-area">
                <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —á–∞—Ç–∞ -->
                <div class="chat-header" id="chat-header">
                    <div class="chat-user-info">
                        <div class="chat-user-avatar" id="chat-user-avatar"></div>
                        <div>
                            <h3 id="chat-user-name">–í—ã–±–µ—Ä–∏—Ç–µ —á–∞—Ç</h3>
                            <p id="chat-user-status" class="user-status">–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–æ–Ω—Ç–∞–∫—Ç —Å–ª–µ–≤–∞</p>
                        </div>
                    </div>
                    
                    <div class="chat-actions">
                        <button class="action-btn" onclick="clearChat()" title="–û—á–∏—Å—Ç–∏—Ç—å —á–∞—Ç">
                            <i class="fas fa-trash"></i>
                        </button>
                        <button class="action-btn" onclick="callUser()" title="–ü–æ–∑–≤–æ–Ω–∏—Ç—å">
                            <i class="fas fa-phone"></i>
                        </button>
                    </div>
                </div>

                <!-- –°–æ–æ–±—â–µ–Ω–∏—è -->
                <div class="messages-container" id="messages-container">
                    <div class="welcome-message" id="welcome-message">
                        <div class="welcome-content">
                            <i class="fas fa-rocket"></i>
                            <h2>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</h2>
                            <p>–≠—Ç–æ—Ç –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ C++ —á–µ—Ä–µ–∑ WebAssembly</p>
                            <p>–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–Ω—Ç–∞–∫—Ç –¥–ª—è –Ω–∞—á–∞–ª–∞ –æ–±—â–µ–Ω–∏—è</p>
                            <div class="loading-indicator">
                                <div class="loading-dot"></div>
                                <div class="loading-dot"></div>
                                <div class="loading-dot"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- –ü–∞–Ω–µ–ª—å –≤–≤–æ–¥–∞ -->
                <div class="input-area">
                    <div class="input-tools">
                        <button class="tool-btn" onclick="addEmoji()" title="–≠–º–æ–¥–∑–∏">
                            <i class="far fa-smile"></i>
                        </button>
                        <button class="tool-btn" onclick="attachFile()" title="–ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å —Ñ–∞–π–ª">
                            <i class="fas fa-paperclip"></i>
                        </button>
                    </div>
                    
                    <div class="message-input-wrapper">
                        <textarea 
                            id="message-input" 
                            placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." 
                            rows="1"
                            onkeydown="handleKeyPress(event)"
                        ></textarea>
                        <button class="send-btn" onclick="sendMessage()" title="–û—Ç–ø—Ä–∞–≤–∏—Ç—å">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ -->
    <div id="settings-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-sliders-h"></i> –ù–∞—Å—Ç—Ä–æ–π–∫–∏</h3>
                <button class="close-modal" onclick="closeSettings()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="settings-section">
                    <h4><i class="fas fa-user"></i> –ü—Ä–æ—Ñ–∏–ª—å</h4>
                    <div class="setting-item">
                        <label>–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:</label>
                        <input type="text" id="username-input" value="–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å">
                    </div>
                    <div class="setting-item">
                        <label>–°—Ç–∞—Ç—É—Å:</label>
                        <select id="status-select">
                            <option value="online">–í —Å–µ—Ç–∏</option>
                            <option value="away">–û—Ç–æ—à–µ–ª</option>
                            <option value="busy">–ó–∞–Ω—è—Ç</option>
                            <option value="offline">–ù–µ –≤ —Å–µ—Ç–∏</option>
                        </select>
                    </div>
                </div>
                
                <div class="settings-section">
                    <h4><i class="fas fa-bell"></i> –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</h4>
                    <div class="setting-item">
                        <label>
                            <input type="checkbox" id="notify-sound" checked>
                            –ó–≤—É–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
                        </label>
                    </div>
                    <div class="setting-item">
                        <label>
                            <input type="checkbox" id="notify-popup" checked>
                            –í—Å–ø–ª—ã–≤–∞—é—â–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
                        </label>
                    </div>
                </div>
                
                <div class="settings-section">
                    <h4><i class="fas fa-database"></i> –î–∞–Ω–Ω—ã–µ</h4>
                    <div class="setting-item">
                        <button class="btn-secondary" onclick="clearAllData()">
                            <i class="fas fa-trash"></i> –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ
                        </button>
                    </div>
                    <div class="setting-item">
                        <button class="btn-secondary" onclick="exportChat()">
                            <i class="fas fa-file-export"></i> –≠–∫—Å–ø–æ—Ä—Ç —á–∞—Ç–∞
                        </button>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-primary" onclick="saveSettings()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                <button class="btn-secondary" onclick="closeSettings()">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>

    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º WebAssembly –º–æ–¥—É–ª—å -->
    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let Module = {};
        let currentUser = null;
        let currentChat = null;
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        window.onload = async function() {
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º C++ –º–æ–¥—É–ª—å
            await initCppModule();
            
            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–µ—Å—Å–∏—é –µ—Å–ª–∏ –µ—Å—Ç—å
            restoreSession();
            
            // –ù–∞–∑–Ω–∞—á–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
            setupEventListeners();
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
            showNotification('C++ Messenger', '–°–∏—Å—Ç–µ–º–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞. –í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.');
        };
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è C++ –º–æ–¥—É–ª—è
        async function initCppModule() {
            try {
                // –°–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å C++
                Module = {
                    onRuntimeInitialized: function() {
                        console.log('C++ –º–æ–¥—É–ª—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
                        
                        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä –≤ C++
                        if (Module._initMessenger) {
                            Module._initMessenger();
                            updateStatus('C++ Core: –ê–∫—Ç–∏–≤–µ–Ω');
                        }
                    }
                };
                
                // –ó–¥–µ—Å—å –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π .wasm —Ñ–∞–π–ª
                // –î–ª—è –¥–µ–º–æ —Å–æ–∑–¥–∞–µ–º –∑–∞–≥–ª—É—à–∫—É
                createMockCppModule();
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ C++ –º–æ–¥—É–ª—è:', error);
                createMockCppModule();
            }
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–≥–ª—É—à–∫–∏ C++ –º–æ–¥—É–ª—è –¥–ª—è –¥–µ–º–æ
        function createMockCppModule() {
            console.log('–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è JavaScript —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è (C++ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)');
            
            // –ò–º–∏—Ç–∞—Ü–∏—è C++ —Ñ—É–Ω–∫—Ü–∏–π
            Module._initMessenger = function() {
                console.log('C++: –ú–µ—Å—Å–µ–Ω–¥–∂–µ—Ä –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
            };
            
            Module._addMessage = function(userId, text) {
                console.log(`C++: –î–æ–±–∞–≤–ª–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç ${userId}: ${text}`);
                return 1;
            };
            
            Module._getMessages = function(userId) {
                console.log(`C++: –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è ${userId}`);
                return "[]";
            };
            
            Module._getContacts = function() {
                return '[{"id":1,"name":"–ê–ª–µ–∫—Å–µ–π","online":true},{"id":2,"name":"–ú–∞—Ä–∏—è","online":true},{"id":3,"name":"–î–º–∏—Ç—Ä–∏–π","online":true},{"id":4,"name":"–ê–Ω–Ω–∞","online":true}]';
            };
            
            Module._getUserInfo = function(userId) {
                const users = {
                    1: {id: 1, name: "–ê–ª–µ–∫—Å–µ–π", status: "–í —Å–µ—Ç–∏", avatar: "üë®‚Äçüíª"},
                    2: {id: 2, name: "–ú–∞—Ä–∏—è", status: "–í —Å–µ—Ç–∏", avatar: "üë©‚Äçüíª"},
                    3: {id: 3, name: "–î–º–∏—Ç—Ä–∏–π", status: "–í —Å–µ—Ç–∏", avatar: "üë®‚Äçüîß"},
                    4: {id: 4, name: "–ê–Ω–Ω–∞", status: "–í —Å–µ—Ç–∏", avatar: "üë©‚Äçüî¨"}
                };
                return JSON.stringify(users[userId] || {});
            };
            
            Module._saveData = function() {
                console.log('C++: –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã');
                return 1;
            };
            
            Module._loadData = function() {
                console.log('C++: –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã');
                return 1;
            };
            
            Module._clearChat = function(userId) {
                console.log(`C++: –ß–∞—Ç —Å ${userId} –æ—á–∏—â–µ–Ω`);
                return 1;
            };
            
            // –°–∏–º—É–ª–∏—Ä—É–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é
            setTimeout(() => {
                if (Module.onRuntimeInitialized) {
                    Module.onRuntimeInitialized();
                }
            }, 500);
        }
        
        // –í—ã–±–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function selectUser(userId) {
            currentUser = {
                id: userId,
                name: getMockUserName(userId),
                avatar: getMockUserAvatar(userId)
            };
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            
            // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º —ç–∫—Ä–∞–Ω—ã
            document.getElementById('login-screen').classList.remove('active');
            document.getElementById('messenger-screen').classList.add('active');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            updateCurrentUserInfo();
            loadContacts();
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            showNotification('–í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω', `–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${currentUser.name}!`);
            
            // –°–∏–º—É–ª–∏—Ä—É–µ–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
            simulateWelcomeMessages();
        }
        
        // –í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã
        function logout() {
            Swal.fire({
                title: '–í—ã—Ö–æ–¥',
                text: '–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –≤—ã–π—Ç–∏?',
                icon: 'question',
                showCancelButton: true,
                confirmButtonText: '–í—ã–π—Ç–∏',
                cancelButtonText: '–û—Ç–º–µ–Ω–∞'
            }).then((result) => {
                if (result.isConfirmed) {
                    // –û—á–∏—â–∞–µ–º —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                    currentUser = null;
                    localStorage.removeItem('currentUser');
                    
                    // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º —ç–∫—Ä–∞–Ω—ã
                    document.getElementById('messenger-screen').classList.remove('active');
                    document.getElementById('login-screen').classList.add('active');
                    
                    showNotification('–í—ã—Ö–æ–¥', '–í—ã —É—Å–ø–µ—à–Ω–æ –≤—ã—à–ª–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã');
                }
            });
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç–µ–∫—É—â–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
        function updateCurrentUserInfo() {
            if (!currentUser) return;
            
            document.getElementById('current-user-name').textContent = currentUser.name;
            document.getElementById('current-user-avatar').innerHTML = currentUser.avatar;
            document.getElementById('current-user-status').textContent = '–í —Å–µ—Ç–∏';
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤
        function loadContacts() {
            const contactsList = document.getElementById('contacts-list');
            contactsList.innerHTML = '';
            
            try {
                // –ü–æ–ª—É—á–∞–µ–º –∫–æ–Ω—Ç–∞–∫—Ç—ã –∏–∑ C++
                const contactsJson = Module._getContacts();
                const contacts = JSON.parse(contactsJson);
                
                contacts.forEach(contact => {
                    if (contact.id === currentUser.id) return; // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                    
                    const contactElement = document.createElement('div');
                    contactElement.className = 'contact-item';
                    contactElement.onclick = () => openChat(contact.id);
                    
                    contactElement.innerHTML = `
                        <div class="contact-avatar">${getMockUserAvatar(contact.id)}</div>
                        <div class="contact-details">
                            <h4>${contact.name}</h4>
                            <p class="contact-status ${contact.online ? 'online' : 'offline'}">
                                ${contact.online ? '–í —Å–µ—Ç–∏' : '–ù–µ –≤ —Å–µ—Ç–∏'}
                            </p>
                        </div>
                        <div class="contact-time">—Ç–æ–ª—å–∫–æ —á—Ç–æ</div>
                    `;
                    
                    contactsList.appendChild(contactElement);
                });
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤:', error);
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–µ–º–æ –∫–æ–Ω—Ç–∞–∫—Ç—ã
                loadDemoContacts();
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–µ–º–æ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤
        function loadDemoContacts() {
            const contactsList = document.getElementById('contacts-list');
            const demoContacts = [
                {id: 1, name: "–ê–ª–µ–∫—Å–µ–π", online: true},
                {id: 2, name: "–ú–∞—Ä–∏—è", online: true},
                {id: 3, name: "–î–º–∏—Ç—Ä–∏–π", online: true},
                {id: 4, name: "–ê–Ω–Ω–∞", online: true}
            ];
            
            demoContacts.forEach(contact => {
                if (contact.id === currentUser.id) return;
                
                const contactElement = document.createElement('div');
                contactElement.className = 'contact-item';
                contactElement.onclick = () => openChat(contact.id);
                
                contactElement.innerHTML = `
                    <div class="contact-avatar">${getMockUserAvatar(contact.id)}</div>
                    <div class="contact-details">
                        <h4>${contact.name}</h4>
                        <p class="contact-status ${contact.online ? 'online' : 'offline'}">
                            ${contact.online ? '–í —Å–µ—Ç–∏' : '–ù–µ –≤ —Å–µ—Ç–∏'}
                        </p>
                    </div>
                    <div class="contact-time">—Ç–æ–ª—å–∫–æ —á—Ç–æ</div>
                `;
                
                contactsList.appendChild(contactElement);
            });
        }
        
        // –û—Ç–∫—Ä—ã—Ç–∏–µ —á–∞—Ç–∞
        function openChat(userId) {
            currentChat = userId;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ —á–∞—Ç–∞
            const userName = getMockUserName(userId);
            const userAvatar = getMockUserAvatar(userId);
            
            document.getElementById('chat-user-name').textContent = userName;
            document.getElementById('chat-user-avatar').innerHTML = userAvatar;
            document.getElementById('chat-user-status').textContent = '–í —Å–µ—Ç–∏';
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è
            loadMessages(userId);
            
            // –°–∫—Ä—ã–≤–∞–µ–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
            document.getElementById('welcome-message').style.display = 'none';
            
            // –ü–æ–º–µ—á–∞–µ–º –∫–æ–Ω—Ç–∞–∫—Ç –∫–∞–∫ –∞–∫—Ç–∏–≤–Ω—ã–π
            document.querySelectorAll('.contact-item').forEach(item => {
                item.classList.remove('active');
                if (item.querySelector('h4').textContent === userName) {
                    item.classList.add('active');
                }
            });
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
        function loadMessages(userId) {
            const messagesContainer = document.getElementById('messages-container');
            
            try {
                // –ü–æ–ª—É—á–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ C++
                const messagesJson = Module._getMessages(userId);
                const messages = JSON.parse(messagesJson);
                
                // –û—á–∏—â–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
                messagesContainer.innerHTML = '';
                
                if (messages.length === 0) {
                    showNoMessages();
                    return;
                }
                
                // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è
                messages.forEach(msg => {
                    addMessageToUI(msg);
                });
                
                // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –≤–Ω–∏–∑
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π:', error);
                showDemoMessages();
            }
        }
        
        // –ü–æ–∫–∞–∑ –¥–µ–º–æ —Å–æ–æ–±—â–µ–Ω–∏–π
        function showDemoMessages() {
            const messagesContainer = document.getElementById('messages-container');
            messagesContainer.innerHTML = '';
            
            const demoMessages = [
                {id: 1, senderId: currentChat, text: "–ü—Ä–∏–≤–µ—Ç! –ö–∞–∫ –¥–µ–ª–∞?", timestamp: "10:30", isSent: false},
                {id: 2, senderId: currentUser.id, text: "–ü—Ä–∏–≤–µ—Ç! –í—Å–µ –æ—Ç–ª–∏—á–Ω–æ, —Å–ø–∞—Å–∏–±–æ!", timestamp: "10:32", isSent: true},
                {id: 3, senderId: currentChat, text: "–ö–∞–∫ –ø—Ä–æ–¥–≤–∏–≥–∞–µ—Ç—Å—è –ø—Ä–æ–µ–∫—Ç –Ω–∞ C++?", timestamp: "10:33", isSent: false},
                {id: 4, senderId: currentUser.id, text: "–û—Ç–ª–∏—á–Ω–æ! WebAssembly —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ", timestamp: "10:35", isSent: true},
                {id: 5, senderId: currentChat, text: "–ö—Ä—É—Ç–æ! –ñ–¥—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ üòä", timestamp: "10:36", isSent: false}
            ];
            
            demoMessages.forEach(msg => {
                addMessageToUI(msg);
            });
            
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }
        
        // –°–æ–æ–±—â–µ–Ω–∏–µ "–Ω–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π"
        function showNoMessages() {
            const messagesContainer = document.getElementById('messages-container');
            messagesContainer.innerHTML = `
                <div class="no-messages">
                    <i class="fas fa-comment-slash"></i>
                    <h3>–ù–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π</h3>
                    <p>–ù–∞—á–Ω–∏—Ç–µ –ø–µ—Ä–≤—ã–º –æ–±—â–µ–Ω–∏–µ —Å ${getMockUserName(currentChat)}</p>
                </div>
            `;
        }
        
        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ UI
        function addMessageToUI(message) {
            const messagesContainer = document.getElementById('messages-container');
            const isSent = message.isSent || message.senderId === currentUser.id;
            
            const messageElement = document.createElement('div');
            messageElement.className = `message ${isSent ? 'sent' : 'received'}`;
            
            if (!isSent) {
                messageElement.innerHTML = `
                    <div class="message-sender">${getMockUserName(message.senderId)}</div>
                    <div class="message-content">${message.text}</div>
                    <div class="message-time">${message.timestamp || getCurrentTime()}</div>
                `;
            } else {
                messageElement.innerHTML = `
                    <div class="message-content">${message.text}</div>
                    <div class="message-time">${message.timestamp || getCurrentTime()}</div>
                `;
            }
            
            messagesContainer.appendChild(messageElement);
        }
        
        // –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
        function sendMessage() {
            const input = document.getElementById('message-input');
            const text = input.value.trim();
            
            if (!text || !currentChat) {
                return;
            }
            
            // –°–æ–∑–¥–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
            const message = {
                id: Date.now(),
                senderId: currentUser.id,
                text: text,
                timestamp: getCurrentTime(),
                isSent: true
            };
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ C++
            if (Module._addMessage) {
                Module._addMessage(currentChat, text);
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –≤ UI
            addMessageToUI(message);
            
            // –û—á–∏—â–∞–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞
            input.value = '';
            autoResizeTextarea(input);
            
            // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –≤–Ω–∏–∑
            const messagesContainer = document.getElementById('messages-container');
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
            
            // –°–∏–º—É–ª–∏—Ä—É–µ–º –æ—Ç–≤–µ—Ç
            simulateReply();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ —Å–æ–æ–±—â–µ–Ω–∏–π
            updateMessageCount();
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ
            saveData();
        }
        
        // –°–∏–º—É–ª—è—Ü–∏—è –æ—Ç–≤–µ—Ç–∞
        function simulateReply() {
            if (!currentChat) return;
            
            const replies = {
                1: ["–û—Ç–ª–∏—á–Ω–æ! C++ —Ä—É–ª–∏—Ç!", "–ü—Ä–æ–≤–µ—Ä–∏–ª –∫–æ–¥, –≤—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç!", "–î–∞–≤–∞–π –≤—Å—Ç—Ä–µ—Ç–∏–º—Å—è –Ω–∞ code review", "–î–æ–±–∞–≤–∏–ª –Ω–æ–≤—ã–µ —Ñ–∏—á–∏ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π"],
                2: ["–ü–æ–Ω—è–ª–∞! React —Ç–æ–∂–µ –∫—Ä—É—Ç–æ–π", "Frontend –≥–æ—Ç–æ–≤, –∂–¥—É API", "–î–∏–∑–∞–π–Ω –æ–±–Ω–æ–≤–∏–ª–∞, –ø–æ—Å–º–æ—Ç—Ä–∏", "–¢–µ—Å—Ç–∏—Ä—É—é –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö"],
                3: ["–°–µ—Ä–≤–µ—Ä –Ω–∞—Å—Ç—Ä–æ–µ–Ω, –º–æ–∂–Ω–æ –¥–µ–ø–ª–æ–∏—Ç—å", "Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –≥–æ—Ç–æ–≤—ã", "–ù–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–π–¥–µ–Ω–æ", "–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ"],
                4: ["–î–∞–Ω–Ω—ã–µ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã", "ML –º–æ–¥–µ–ª—å –æ–±—É—á–µ–Ω–∞", "–ì—Ä–∞—Ñ–∏–∫–∏ –ø–æ—Å—Ç—Ä–æ–µ–Ω—ã, —Å–º–æ—Ç—Ä–∏", "–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≥–æ—Ç–æ–≤–∞ –∫ –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏"]
            };
            
            const userReplies = replies[currentChat] || ["–•–æ—Ä–æ—à–æ!", "–ü–æ–Ω—è–ª", "–°–æ–≥–ª–∞—Å–µ–Ω", "–°–ø–∞—Å–∏–±–æ!"];
            const randomReply = userReplies[Math.floor(Math.random() * userReplies.length)];
            
            // –ó–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ –æ—Ç–≤–µ—Ç–æ–º
            setTimeout(() => {
                const replyMessage = {
                    id: Date.now(),
                    senderId: currentChat,
                    text: randomReply,
                    timestamp: getCurrentTime(),
                    isSent: false
                };
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ C++
                if (Module._addMessage) {
                    Module._addMessage(currentUser.id, randomReply);
                }
                
                // –î–æ–±–∞–≤–ª—è–µ–º –≤ UI
                addMessageToUI(replyMessage);
                
                // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –≤–Ω–∏–∑
                const messagesContainer = document.getElementById('messages-container');
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                if (document.getElementById('notify-popup')?.checked) {
                    showNotification(getMockUserName(currentChat), randomReply);
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫
                updateMessageCount();
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ
                saveData();
                
            }, 1000 + Math.random() * 3000);
        }
        
        // –°–∏–º—É–ª—è—Ü–∏—è –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
        function simulateWelcomeMessages() {
            setTimeout(() => {
                // –ü–µ—Ä–≤–æ–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –æ—Ç —Å–ª—É—á–∞–π–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                const otherUsers = [1, 2, 3, 4].filter(id => id !== currentUser.id);
                const randomUser = otherUsers[Math.floor(Math.random() * otherUsers.length)];
                
                const welcomeMessage = {
                    id: Date.now(),
                    senderId: randomUser,
                    text: "–ü—Ä–∏–≤–µ—Ç! –†–∞–¥ –≤–∏–¥–µ—Ç—å —Ç–µ–±—è –≤ C++ Messenger!",
                    timestamp: getCurrentTime(),
                    isSent: false
                };
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º
                if (Module._addMessage) {
                    Module._addMessage(currentUser.id, welcomeMessage.text);
                }
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                showNotification(getMockUserName(randomUser), welcomeMessage.text);
                
            }, 2000);
        }
        
        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        function getMockUserName(userId) {
            const names = {
                1: "–ê–ª–µ–∫—Å–µ–π",
                2: "–ú–∞—Ä–∏—è",
                3: "–î–º–∏—Ç—Ä–∏–π",
                4: "–ê–Ω–Ω–∞"
            };
            return names[userId] || "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å";
        }
        
        function getMockUserAvatar(userId) {
            const avatars = {
                1: "üë®‚Äçüíª",
                2: "üë©‚Äçüíª",
                3: "üë®‚Äçüîß",
                4: "üë©‚Äçüî¨"
            };
            return avatars[userId] || "üë§";
        }
        
        function getCurrentTime() {
            const now = new Date();
            return now.getHours().toString().padStart(2, '0') + ':' + 
                   now.getMinutes().toString().padStart(2, '0');
        }
        
        function autoResizeTextarea(textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = (textarea.scrollHeight) + 'px';
        }
        
        function handleKeyPress(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        }
        
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('collapsed');
        }
        
        function showSettings() {
            document.getElementById('settings-modal').style.display = 'block';
        }
        
        function closeSettings() {
            document.getElementById('settings-modal').style.display = 'none';
        }
        
        function saveSettings() {
            const username = document.getElementById('username-input').value;
            const status = document.getElementById('status-select').value;
            
            if (currentUser) {
                currentUser.name = username;
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                updateCurrentUserInfo();
            }
            
            closeSettings();
            showNotification('–ù–∞—Å—Ç—Ä–æ–π–∫–∏', '–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã');
        }
        
        function clearChat() {
            if (!currentChat) return;
            
            Swal.fire({
                title: '–û—á–∏—Å—Ç–∏—Ç—å —á–∞—Ç',
                text: '–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è?',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: '–£–¥–∞–ª–∏—Ç—å',
                cancelButtonText: '–û—Ç–º–µ–Ω–∞'
            }).then((result) => {
                if (result.isConfirmed) {
                    // –í—ã–∑—ã–≤–∞–µ–º C++ —Ñ—É–Ω–∫—Ü–∏—é
                    if (Module._clearChat) {
                        Module._clearChat(currentChat);
                    }
                    
                    // –û—á–∏—â–∞–µ–º UI
                    const messagesContainer = document.getElementById('messages-container');
                    messagesContainer.innerHTML = '';
                    showNoMessages();
                    
                    showNotification('–ß–∞—Ç –æ—á–∏—â–µ–Ω', '–í—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è —É–¥–∞–ª–µ–Ω—ã');
                    updateMessageCount();
                }
            });
        }
        
        function clearAllData() {
            Swal.fire({
                title: '–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ',
                text: '–≠—Ç–æ —É–¥–∞–ª–∏—Ç –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: '–£–¥–∞–ª–∏—Ç—å –≤—Å–µ',
                cancelButtonText: '–û—Ç–º–µ–Ω–∞',
                confirmButtonColor: '#ff3b30'
            }).then((result) => {
                if (result.isConfirmed) {
                    // –û—á–∏—â–∞–µ–º localStorage
                    localStorage.clear();
                    
                    // –û—á–∏—â–∞–µ–º UI
                    if (currentUser) {
                        logout();
                    }
                    
                    showNotification('–î–∞–Ω–Ω—ã–µ –æ—á–∏—â–µ–Ω—ã', '–í—Å–µ –¥–∞–Ω–Ω—ã–µ —É–¥–∞–ª–µ–Ω—ã');
                }
            });
        }
        
        function exportData() {
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—ã–ª –±—ã —ç–∫—Å–ø–æ—Ä—Ç —á–µ—Ä–µ–∑ C++
            showNotification('–≠–∫—Å–ø–æ—Ä—Ç', '–§—É–Ω–∫—Ü–∏—è —ç–∫—Å–ø–æ—Ä—Ç–∞ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ (C++ –º–æ–¥—É–ª—å)');
        }
        
        function exportChat() {
            showNotification('–≠–∫—Å–ø–æ—Ä—Ç —á–∞—Ç–∞', '–§—É–Ω–∫—Ü–∏—è —ç–∫—Å–ø–æ—Ä—Ç–∞ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ');
        }
        
        function callUser() {
            if (!currentChat) return;
            showNotification('–ó–≤–æ–Ω–æ–∫', `–í—ã–∑–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${getMockUserName(currentChat)}...`);
        }
        
        function addEmoji() {
            const emojis = ['üòä', 'üòÇ', 'ü§î', 'üòé', 'üöÄ', 'üíª', 'üî•', 'üéØ', '‚≠ê', '‚ù§Ô∏è'];
            const randomEmoji = emojis[Math.floor(Math.random() * emojis.length)];
            
            const input = document.getElementById('message-input');
            input.value += randomEmoji;
            input.focus();
            autoResizeTextarea(input);
        }
        
        function attachFile() {
            showNotification('–í–ª–æ–∂–µ–Ω–∏–µ', '–§—É–Ω–∫—Ü–∏—è –ø—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ');
        }
        
        function updateStatus(text) {
            const statusElement = document.getElementById('cpp-status');
            if (statusElement) {
                statusElement.textContent = text;
            }
        }
        
        function updateMessageCount() {
            // –ü—Ä–æ—Å—Ç–∞—è –¥–µ–º–æ –ª–æ–≥–∏–∫–∞
            const countElement = document.getElementById('message-count');
            if (countElement) {
                const currentCount = parseInt(countElement.textContent) || 0;
                countElement.textContent = (currentCount + 1).toString();
            }
        }
        
        function saveData() {
            if (Module._saveData) {
                Module._saveData();
            }
        }
        
        function restoreSession() {
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                try {
                    currentUser = JSON.parse(savedUser);
                    document.getElementById('login-screen').classList.remove('active');
                    document.getElementById('messenger-screen').classList.add('active');
                    updateCurrentUserInfo();
                    loadContacts();
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Å–µ—Å—Å–∏–∏:', error);
                }
            }
        }
        
        function setupEventListeners() {
            // –ü–æ–∏—Å–∫ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤
            const searchInput = document.getElementById('search-contacts');
            if (searchInput) {
                searchInput.addEventListener('input', function() {
                    const searchTerm = this.value.toLowerCase();
                    const contacts = document.querySelectorAll('.contact-item');
                    
                    contacts.forEach(contact => {
                        const name = contact.querySelector('h4').textContent.toLowerCase();
                        if (name.includes(searchTerm)) {
                            contact.style.display = 'flex';
                        } else {
                            contact.style.display = 'none';
                        }
                    });
                });
            }
            
            // –ê–≤—Ç–æ—Ä–∞–∑–º–µ—Ä textarea
            const messageInput = document.getElementById('message-input');
            if (messageInput) {
                messageInput.addEventListener('input', function() {
                    autoResizeTextarea(this);
                });
            }
            
            // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
            window.addEventListener('click', function(event) {
                const modal = document.getElementById('settings-modal');
                if (event.target === modal) {
                    closeSettings();
                }
            });
        }
        
        function showNotification(title, message) {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
            const soundEnabled = document.getElementById('notify-sound')?.checked ?? true;
            const popupEnabled = document.getElementById('notify-popup')?.checked ?? true;
            
            if (popupEnabled) {
                Swal.fire({
                    title: title,
                    text: message,
                    icon: 'info',
                    timer: 3000,
                    showConfirmButton: false,
                    toast: true,
                    position: 'top-end'
                });
            }
            
            if (soundEnabled) {
                playNotificationSound();
            }
        }
        
        function playNotificationSound() {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.value = 800;
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                
                oscillator.start();
                oscillator.stop(audioContext.currentTime + 0.3);
            } catch (e) {
                console.log('–ó–≤—É–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è');
            }
        }
    </script>
</body>
</html>
